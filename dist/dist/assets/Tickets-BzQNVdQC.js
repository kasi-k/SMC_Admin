import{r as l,u as C,d as T,A as x,j as e,l as h,m as S,D as v}from"./index-BzYBcspH.js";import{P as E,C as P,a as I,E as M,u as n,w as _,b as z}from"./jspdf.plugin.autotable-DHxsfK2G.js";import{E as F}from"./pencil-DAlNEmyY.js";import"./index-B7YoF_5a.js";import"./typeof-QjJsDpFa.js";const V=({permissions:o})=>{const b=o==null?void 0:o.includes("view"),[c,p]=l.useState([]),[d,m]=l.useState(!1),[j,N]=l.useState(""),g=C();l.useEffect(()=>{f()},[d]);const f=async()=>{try{const r=(await T.get(`${x}/api/getticket`)).data.ticket;p(r)}catch(t){console.log(t)}},k=t=>{N(`${x}/api/deleteticket?ticketId=${t}`),m(!0)},w=()=>{m(!1)},i=()=>c.map(t=>({"User Id":t._id,"First Name":t.fname,"Last Name":t.lname,Email:t.email,Phone:t.phone,Ticket:t.ticketId,Category:t.category,Status:t.status,Date:h(t.createdAt),"Team Member":t.team,Priority:t.priority})),y=()=>{const t=n.json_to_sheet(i()),r=[{wpx:180},{wpx:100},{wpx:100},{wpx:180},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100},{wpx:100}];t["!cols"]=r;const a=n.book_new();n.book_append_sheet(a,t,"Tickets"),_(a,"SMC_Tickets.xlsx")},u=()=>{const t=new z("landscape","mm","a4"),r=["User Id","First Name","Last Name","Email","Phone","Ticket","Category","Status","Date","Team Member","Priority"],a=i().map(s=>[s["User Id"],s["First Name"],s["Last Name"],s.Email,s.Phone,s.Ticket,s.Category,s.Status,s.Date,s["Team Member"],s.Priority]);t.autoTable({head:[r],body:a,startY:20,theme:"grid",headStyles:{fillColor:[97,144,213],textColor:[255,255,255],fontStyle:"bold",halign:"center"},bodyStyles:{textColor:[0,0,0],halign:"center"}}),t.save("SMC_Tickets.pdf")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" font-extralight",children:[e.jsxs("div",{className:"flex justify-between items-center my-2",children:[e.jsx("p",{className:" mx-2 mt-6",children:"Help and Support "}),e.jsxs("div",{className:" mx-2 flex gap-6 mt-4",children:[e.jsx("button",{onClick:u,children:e.jsx("img",{className:"size-8",src:E,alt:"Pdf image"})}),e.jsx(P,{data:i(),filename:"SMC_tickets.csv",className:"cursor-pointer",target:"_blank",children:e.jsx("img",{className:"size-8",src:I,alt:"csv image"})}),e.jsx("button",{onClick:y,children:e.jsx("img",{className:"size-8 ",src:M,alt:"excel image"})})]})]}),e.jsx("div",{className:"mx-1 overflow-auto no-scrollbar  ",children:e.jsxs("table",{className:" w-full",children:[e.jsx("thead",{className:"text-slate-300",children:e.jsxs("tr",{children:[e.jsx("th",{className:" font-extralight border border-slate-400",children:"User Id"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"First Name"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"Last Name"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Email"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Phone"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Ticket#"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Category"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Status"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Date"}),e.jsx("th",{className:"text-nowrap font-extralight border border-slate-400",children:"Team Member"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Priority"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Action"})]})}),e.jsx("tbody",{className:"text-slate-400 ",children:c&&c.map((t,r)=>e.jsxs("tr",{className:" text-nowrap text-center ",children:[e.jsx("td",{className:"border border-slate-400 p-2",children:t._id}),e.jsx("td",{className:"border border-slate-400 capitalize",children:t.fname}),e.jsx("td",{className:"border border-slate-400 capitalize",children:t.lname}),e.jsx("td",{className:"border border-slate-400",children:t.email}),e.jsx("td",{className:"border border-slate-400",children:t.phone}),e.jsx("td",{className:"border border-slate-400",children:t.ticketId}),e.jsx("td",{className:"border border-slate-400 capitalize",children:t.category}),e.jsxs("td",{className:"border border-slate-400 capitalize",children:[t.status," "]}),e.jsx("td",{className:"border border-slate-400 text-slate-500 ",children:h(t.createdAt)}),e.jsx("td",{className:"border border-slate-400 capitalize",children:t.team}),e.jsxs("td",{className:"border border-slate-400",children:[t.priority," "]}),e.jsxs("td",{className:"flex items-center justify-evenly border-b border-r border-slate-400  ",children:[b&&e.jsx("p",{onClick:()=>g("/viewticket",{state:{ticketId:t.ticketId}}),className:" cursor-pointer p-2 text-green-600 ",children:e.jsx("img",{className:"size-6 ",src:F,alt:"edit image"})}),e.jsx("p",{onClick:()=>{k(t.ticketId)},className:"cursor-pointer ",children:e.jsx("img",{className:"size-6",src:S,alt:"delete image"})})]})]},r))})]})})]}),d&&e.jsx(v,{onClose:w,title:"ticket",onDelete:j})]})};export{V as default};
