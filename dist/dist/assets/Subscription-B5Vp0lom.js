import{r as c,d as w,j as e,M as P,S as I,l as u,B as y,A as v}from"./index-CrC78F0C.js";import{b as S,P as C,C as F,a as M,E as $,u as f,w as k}from"./jspdf.plugin.autotable-BYFa8mm3.js";import{F as z}from"./index-Bti3r1Vx.js";import D from"./html2canvas.esm-CBrSDip1.js";import{A as E}from"./index-15r3fjUn.js";import"./index-wcn2dDzh.js";import"./typeof-QjJsDpFa.js";const A=({onClose:d,invoiceData:h})=>{const[r,p]=c.useState([]),[x,b]=c.useState(!1),o=c.useRef();c.useEffect(()=>{j()},[]);const j=async()=>{try{const l=(await w.get(h)).data.sub;p(l)}catch(a){console.log(a)}},N=async()=>{b(!0);try{const a=await D(o.current,{scale:2}),l=a.toDataURL("image/png"),s=new S("p","mm","a4"),t=s.internal.pageSize.getWidth(),i=a.height*t/a.width;s.addImage(l,"PNG",0,0,t,i),s.save("SMC_Invoice.pdf"),y.success("Invoice downloaded as PDF!")}catch(a){console.error("Error generating PDF:",a),y.error("Failed to generate PDF.")}finally{b(!1)}},m=(a,l)=>{const s=l==="stripe",t=l==="razorpay";return s?`$ ${a}`:t?`₹ ${a}`:`${a}`},g=(a,l)=>{const s=l==="stripe",t=l==="razorpay";return s?`${a} USD`:t?`${a} INR`:`${a}`};return e.jsx(P,{children:e.jsxs("div",{className:"bg-white",children:[r&&e.jsxs("div",{className:"max-w-xl h-auto bg-white py-1 px-2 font-poppins font-extralight",ref:o,children:[e.jsx("span",{className:"flex justify-center my-3",children:e.jsx("img",{src:I,alt:"Image",className:"w-48 "})}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 font-normal",children:[e.jsx("p",{className:"font-normal",children:"Payment Method:"}),e.jsx("p",{children:"Plan:"}),e.jsx("p",{children:"Subscription ID:"}),e.jsx("p",{children:"Customer ID:"}),e.jsx("p",{children:"Amount:"})]}),e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{children:r.method}),e.jsx("p",{children:r.plan}),e.jsx("p",{children:r.subscriberId}),e.jsx("p",{children:"cus_QXoP8hrt4tOqIh"}),e.jsx("p",{children:g(r.amount,r.method)})]})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 font-normal ",children:[e.jsx("p",{children:"Receipt #:"}),e.jsx("p",{children:"Date:"})]}),e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{children:"256746746444"}),e.jsx("p",{children:u(r.date)})]})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3",children:[e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{className:"font-normal",children:"Basic Monthly Plan:"}),e.jsxs("p",{children:["Qty ",r.course]})]}),e.jsx("div",{className:"col-span-6 ",children:e.jsx("p",{children:m(r.amount,r.method)})})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{className:"font-normal",children:"Tax:"}),e.jsxs("p",{children:[r.tax,"%"]})]}),e.jsx("div",{className:"col-span-6 ",children:e.jsx("p",{children:r.method==="razorpay"?`₹ ${(Number(r.tax)/100).toFixed(2)}`:`$ ${(Number(r.tax)/100).toFixed(2)}`})})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsx("div",{className:"col-span-6 font-normal",children:e.jsx("p",{children:"Grand Total:"})}),e.jsx("div",{className:"col-span-6 ",children:r.amount&&r.tax&&e.jsx("p",{children:r.method==="razorpay"?`₹ ${(Number(r.amount)+Number(r.tax)/100).toFixed(0)}`:`$ ${(Number(r.amount)+Number(r.tax)/100).toFixed(2)}`})})]})]}),e.jsxs("div",{className:"flex justify-evenly items-center my-8 ",children:[e.jsx("p",{onClick:d,className:" cursor-pointer text-lg  bg-white  border-2 border-black text-center text-black px-10 py-2.5  ",children:"Cancel"}),e.jsx("button",{className:`text-lg  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] w-52 py-2.5 ${x?"opacity-15":""}`,disabled:x,onClick:N,children:x?e.jsxs("span",{className:"flex justify-center gap-3",children:[" ",e.jsx(E,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Downloading ...."})]}):"Download Invoice"})]})]})})},O=({permissions:d})=>{const h=d==null?void 0:d.includes("view"),[r,p]=c.useState(!1),[x,b]=c.useState({}),[o,j]=c.useState([]);c.useEffect(()=>{N()},[]);const N=async()=>{try{const t=(await w.get(`${v}/api/getallsubs`)).data.sub;j(t)}catch(s){console.log(s)}},m=()=>o.map(s=>({"User Id":s._id,"First Name":s.fname,"Last Name":s.lname,Email:s.email,Phone:s.phone,Date:u(s.date),Plan:s.plan,Amount:s.amount,Transaction:s.subscriberId,"Payment Mode":s.method})),g=()=>{const s=f.json_to_sheet(m()),t=[{wpx:180},{wpx:100},{wpx:100},{wpx:180},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80}];s["!cols"]=t;const i=f.book_new();f.book_append_sheet(i,s,"subscription"),k(i,"SMC Subscription.xlsx")},a=()=>{const s=new S,t=["User Id","First Name","Last Name","Email","Phone","Date","Plan","Amount","Transaction","Payment Mode"],i=m().map(n=>[n["User Id"],n["First Name"],n["Last Name"],n.Email,n.Phone,n.Date,n.Plan,n.Amount,n.Transaction,n["Payment Mode"]]);s.autoTable({head:[t],body:i,startY:20,theme:"grid",headStyles:{fillColor:[97,144,213],textColor:[255,255,255],fontStyle:"bold",halign:"center"},bodyStyles:{textColor:[0,0,0],halign:"center"}}),s.save("SMC_Subscription.pdf")},l=s=>{b(`${v}/api/getsubonid/${s}`),p(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" font-extralight",children:[e.jsxs("div",{className:"flex justify-between items-center my-2",children:[e.jsx("p",{className:" mx-2 mt-6",children:"Subscription"}),e.jsxs("div",{className:" mx-2 flex gap-6 mt-4",children:[e.jsx("button",{onClick:a,children:e.jsx("img",{className:"size-8",src:C,alt:"Pdf image"})}),e.jsx(F,{data:m(),filename:"SMC_Subscription.csv",className:"cursor-pointer",target:"_blank",children:e.jsx("img",{className:"size-8",src:M,alt:"csv image"})}),e.jsx("button",{onClick:g,children:e.jsx("img",{className:" size-8",src:$,alt:"excel image"})})]})]}),e.jsx("div",{className:"mx-1 overflow-auto no-scrollbar ",children:e.jsxs("table",{className:"  w-full",children:[e.jsx("thead",{className:"text-slate-300 ",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-extralight border border-slate-400",children:"User Id"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"First Name"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"Last Name"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Email"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Phone"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Date"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Plan"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Amount"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Transaction id"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"Payment Mode"}),h&&e.jsx("th",{className:"font-extralight border border-slate-400",children:"Action"})]})}),e.jsx("tbody",{className:"text-slate-400  ",children:o&&o.map((s,t)=>e.jsxs("tr",{className:" text-nowrap text-center",children:[e.jsx("td",{className:"border border-slate-400  ",children:s._id}),e.jsxs("td",{className:"border border-slate-400 capitalize ",children:[s.fname," "]}),e.jsx("td",{className:"border border-slate-400 capitalize ",children:s.lname}),e.jsx("td",{className:"border border-slate-400",children:s.email}),e.jsx("td",{className:"border border-slate-400",children:s.phone}),e.jsx("td",{className:"border border-slate-400",children:u(s.date)}),e.jsxs("td",{className:"border border-slate-400 px-2 capitalize ",children:[" ",s.plan]}),e.jsx("td",{className:"border border-slate-400 ",children:s.amount}),e.jsx("td",{className:"border border-slate-400 ",children:s.subscriberId}),e.jsx("td",{className:"border border-slate-400 capitalize",children:s.method}),e.jsx("td",{className:" border-b border-r border-slate-400 flex  justify-center items-center  ",children:h&&e.jsx("p",{onClick:()=>l(s._id),className:" cursor-pointer p-2  text-green-600 ",children:e.jsx(z,{size:24})})})]},t))})]})})]}),r&&e.jsx(A,{onClose:()=>p(),invoiceData:x})]})};export{O as default};
